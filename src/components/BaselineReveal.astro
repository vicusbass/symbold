---
interface Props {
  class?: string;
  delayed?: boolean;
}

const { class: className = '', delayed = false } = Astro.props;
---

<div class="overflow-hidden">
  <div class={className} data-baseline-animation data-delayed={delayed}>
    <slot />
  </div>
</div>

<style>
  [data-baseline-animation] {
    opacity: 0;
    transform: translateY(50%);
    transition:
      transform 0.6s ease-out,
      opacity 0.6s ease-out;
  }

  [data-baseline-animation].visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  function initBaselineAnimations() {
    // Use requestAnimationFrame to ensure browser has painted initial state
    requestAnimationFrame(() => {
      document.querySelectorAll('[data-baseline-animation]').forEach((el) => {
        // Skip if already visible
        if (el.classList.contains('visible')) return;

        const delayed = el.getAttribute('data-delayed') === 'true';
        setTimeout(() => el.classList.add('visible'), delayed ? 300 : 0);
      });
    });
  }

  // Run immediately if DOM is ready (for initial page load)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBaselineAnimations);
  } else {
    // DOM is already ready, run immediately
    initBaselineAnimations();
  }

  // Also listen for Astro page loads (for client-side navigation)
  document.addEventListener('astro:page-load', initBaselineAnimations);
</script>
