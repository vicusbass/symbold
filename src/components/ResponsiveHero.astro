---
import { Image } from 'astro:assets';
import MuxVideo from './MuxVideo.astro';
import { urlFor } from '../lib/sanity';
import type { SanityImage, MuxVideo as MuxVideoType } from '../types/sanity';

interface MediaContent {
  mediaType: 'image' | 'video';
  image?: SanityImage;
  video?: MuxVideoType;
}

interface Props {
  desktopMedia: MediaContent;
  mobileMedia: MediaContent;
  videoTitle?: string;
  class?: string;
}

const { desktopMedia, mobileMedia, videoTitle = '', class: className } = Astro.props;
---

<!-- Mobile Media -->{
  mobileMedia.mediaType === 'image' && mobileMedia.image?.asset?._ref ? (
    (() => {
      try {
        const imageUrl = urlFor(mobileMedia.image)?.url();
        return imageUrl ? (
          <Image
            src={imageUrl}
            alt={mobileMedia.image.alt || ''}
            class:list={['h-auto w-full overflow-hidden rounded-md md:hidden', className]}
            inferSize
          />
        ) : null;
      } catch {
        return null;
      }
    })()
  ) : mobileMedia.mediaType === 'video' && mobileMedia.video?.asset?.playbackId ? (
    <div class="overflow-hidden rounded-md md:hidden">
      <MuxVideo
        playbackId={mobileMedia.video.asset.playbackId}
        videoTitle={videoTitle}
        aspectRatio={mobileMedia.video.asset.aspectRatio}
      />
    </div>
  ) : null
}

<!-- Desktop Media -->
{
  desktopMedia.mediaType === 'image' && desktopMedia.image?.asset?._ref ? (
    (() => {
      try {
        const imageUrl = urlFor(desktopMedia.image)?.url();
        return imageUrl ? (
          <Image
            src={imageUrl}
            alt={desktopMedia.image.alt || ''}
            class:list={['hidden h-auto w-full overflow-hidden rounded-md md:block', className]}
            inferSize
          />
        ) : null;
      } catch {
        return null;
      }
    })()
  ) : desktopMedia.mediaType === 'video' && desktopMedia.video?.asset?.playbackId ? (
    <div class="hidden overflow-hidden rounded-md md:block">
      <MuxVideo
        playbackId={desktopMedia.video.asset.playbackId}
        videoTitle={videoTitle}
        aspectRatio={desktopMedia.video.asset.aspectRatio}
      />
    </div>
  ) : null
}
